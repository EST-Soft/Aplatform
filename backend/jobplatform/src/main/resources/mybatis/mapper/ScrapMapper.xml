<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jobplatform.fo.user.domain.mapper.ScrapMapper">

    <!-- 스크랩 추가 -->
    <insert id="insertScrap">
	    INSERT INTO p5_tbl_scrap (mbr_sq, scrap_target_sq, scrap_target_type, dlt_yn)
	    VALUES (#{mbrSq}, #{scrapTargetSq}, #{scrapTargetType}, 'N')
	</insert>


    <!-- 스크랩 삭제 -->
    <update id="deleteScrap">
        UPDATE P5_TBL_SCRAP
        SET dlt_yn = 'Y', dlt_dtm = NOW()
        WHERE scrap_target_sq = #{scrapTargetSq}
    </update>

    <!-- 특정 회원의 스크랩 목록 조회 -->
    <select id="selectScrapsByMember" resultType="java.util.HashMap">
        SELECT scrap_sq, scrap_target_sq, scrap_target_type, insrt_dtm
        FROM P5_TBL_SCRAP
        WHERE mbr_sq = #{mbrSq} AND dlt_yn = 'N'
        ORDER BY insrt_dtm DESC
    </select>

    <!-- 스크랩 존재 여부 확인 -->
	<select id="checkScrapExists" resultType="boolean">
	    SELECT EXISTS (
	        SELECT 1
	        FROM P5_TBL_SCRAP
	        WHERE mbr_sq = #{mbrSq}
	          AND scrap_target_sq = #{scrapTargetSq} <!-- 올바른 컬럼 이름으로 수정 -->
	          AND scrap_target_type = #{scrapTargetType} <!-- 올바른 컬럼 이름으로 수정 -->
	          AND dlt_yn = 'N' <!-- 테이블의 del_yn 컬럼 사용 -->
	    )
	</select>
</mapper>
